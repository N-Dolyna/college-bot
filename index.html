<!DOCTYPE html>
<html>
<head>
    <title>StudentHub - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .group-selector {
            text-align: center;
        }
        
        .group-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 16px;
            width: 100%;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .week-navigation {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .nav-btn {
            background: #f8f9fa;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
        }
        
        .day-tabs {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            gap: 5px;
        }
        
        .day-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .day-tab.active {
            background: #667eea;
            color: white;
        }
        
        .lesson {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .lesson-time {
            font-weight: bold;
            color: #667eea;
        }
        
        .lesson-subject {
            font-weight: bold;
            margin: 5px 0;
        }
        
        .lesson-teacher {
            color: #666;
            font-size: 14px;
        }
        
        .zoom-link {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì StudentHub</h1>
            <p>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</p>
        </div>
        
        <div class="card group-selector">
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</h3>
            <button class="group-btn" onclick="selectGroup('–û–ü–ö-412')">–û–ü–ö-412</button>
            <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –≥—Ä—É–ø–ø—ã -->
        </div>
        
        <div id="schedule-view" style="display: none;">
            <div class="card">
                <div class="week-navigation">
                    <button class="nav-btn" onclick="showWeekView()">üìÖ –ù–µ–¥–µ–ª—è</button>
                    <button class="nav-btn" onclick="showTodayView()">üìã –°–µ–≥–æ–¥–Ω—è</button>
                </div>
                
                <div id="day-tabs" class="day-tabs">
                    <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div id="lessons-container">
                    <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentGroup = '';
        let currentWeekSchedule = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        async function selectGroup(group) {
            currentGroup = group;
            document.querySelector('.group-selector').style.display = 'none';
            document.getElementById('schedule-view').style.display = 'block';
            
            await loadWeekSchedule(group);
            showWeekView();
        }
        
        async function loadWeekSchedule(group) {
            try {
                const response = await fetch(`${API_BASE}/api/schedule/week/${group}`);
                currentWeekSchedule = await response.json();
                updateDayTabs();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
            }
        }
        
        function updateDayTabs() {
            const daysContainer = document.getElementById('day-tabs');
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
            
            daysContainer.innerHTML = days.map(day => `
                <div class="day-tab ${day === 'monday' ? 'active' : ''}" 
                     onclick="showDay('${day}')">
                    ${currentWeekSchedule.week_schedule[day].day_name}
                </div>
            `).join('');
        }
        
        function showWeekView() {
            showDay('monday'); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        }
        
        function showTodayView() {
            // –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
            fetch(`${API_BASE}/api/schedule/today/${currentGroup}`)
                .then(response => response.json())
                .then(data => {
                    displayLessons(data.lessons, `–°–µ–≥–æ–¥–Ω—è (${data.day_name})`);
                });
        }
        
        function showDay(day) {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.day-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const dayData = currentWeekSchedule.week_schedule[day];
            displayLessons(dayData.lessons, dayData.day_name);
        }
        
        function displayLessons(lessons, dayName) {
            const container = document.getElementById('lessons-container');
            
            if (lessons.length === 0) {
                container.innerHTML = '<div class="lesson">–ü–∞—Ä –Ω–µ—Ç! üéâ</div>';
                return;
            }
            
            container.innerHTML = lessons.map(lesson => `
                <div class="lesson">
                    <div class="lesson-time">${lesson.time}</div>
                    <div class="lesson-subject">${lesson.subject}</div>
                    <div class="lesson-teacher">üë®‚Äçüè´ ${lesson.teacher}</div>
                    ${lesson.zoom_link ? `<a href="${lesson.zoom_link}" class="zoom-link" target="_blank">üîó Zoom</a>` : ''}
                </div>
            `).join('');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É
        });
    </script>
</body>
</html>
